import{d as l}from"./CA2Ut2yR.js";import{u as Z}from"./CpWNbkWp.js";import{d as R,c as d,w as M,ao as ee}from"./Dg7Bj1Dn.js";const ie=R({__name:"CldUploadWidget",props:{onClose:{type:Function},onError:{type:Function},onOpen:{type:Function},onUpload:{type:Function},onAbort:{type:Function},onBatchCancelled:{type:Function},onDisplayChanged:{type:Function},onPublicId:{type:Function},onQueuesEnd:{type:Function},onQueuesStart:{type:Function},onRetry:{type:Function},onShowCompleted:{type:Function},onSourceChanged:{type:Function},onSuccess:{type:Function},onTags:{type:Function},onUploadAdded:{type:Function},options:{},signatureEndpoint:{},uploadPreset:{}},setup(O){function T(e){return window&&"requestIdleCallback"in window?requestIdleCallback(e):setTimeout(()=>e(),1)}const A=["success","display-changed"],D=O,{onClose:p,onError:f,onOpen:y,onUpload:g,options:W,signatureEndpoint:c,uploadPreset:q,onAbort:z,onBatchCancelled:N,onDisplayChanged:Q,onPublicId:k,onQueuesEnd:K,onQueuesStart:L,onRetry:$,onShowCompleted:j,onSourceChanged:B,onSuccess:H,onTags:x,onUploadAdded:G}=D,s=d(),n=d(),J=!!c,a=d(void 0),i=d(void 0),h=d(!0),V={close:m,destroy:w,hide:S,isDestroyed:C,isMinimized:F,isShowing:b,minimize:E,open:U,show:I,update:P,abort:z,"batch-cancelled":N,"display-changed":Q,publicid:k,"queues-end":K,"queues-start":L,retry:$,"show-completed":j,"source-changed":B,success:H,tags:x,"upload-added":G},r={cloudName:l().public.cloudinary.cloudName,uploadPreset:q||l().public.cloudinary.uploadPreset,apiKey:l().public.cloudinary.apiKey,...W,...V};J&&(r.uploadSignature=Y,r.apiKey||console.warn("Missing dependency: Signed Upload requires an API key")),M(i,()=>{var o,_;if(typeof i.value>"u")return;const e=((o=i.value)==null?void 0:o.event)==="success",u=((_=i.value)==null?void 0:_.event)==="display-changed"&&i.value.info==="hidden";e&&typeof g=="function"&&g(i,n.value),u&&typeof p=="function"&&p(n.value)}),M(a,()=>{a.value&&typeof f=="function"&&f(a,n.value)});function X(){h.value=!1,s.value||(s.value=window.cloudinary),T(()=>{n.value||(n.value=v())})}function Y(e,u){if(typeof c>"u")throw Error("Failed to generate signature: signatureEndpoint undefined.");fetch(c,{method:"POST",body:JSON.stringify({paramsToSign:u})}).then(o=>o.json()).then(({signature:o})=>{e(o)})}function v(){var e;return(e=s.value)==null?void 0:e.createUploadWidget(r,(u,o)=>{typeof u<"u"&&(a.value=u),A.includes(o==null?void 0:o.event)&&(i.value=o)})}function t(e){n.value||(n.value=v()),typeof(n==null?void 0:n.value[e])=="function"&&n.value[e]()}function m(){t("close")}function w(){t("destroy")}function S(){t("hide")}function C(){t("isDestroyed")}function F(){t("isMinimized")}function b(){t("isShowing")}function E(){t("minimize")}function I(){t("show")}function P(){t("update")}function U(){t("open"),typeof y=="function"&&y(n.value)}return Z({script:[{id:`cloudinary-uploadwidget-${Math.floor(Math.random()*100)}`,src:"https://widget.cloudinary.com/v2.0/global/all.js",onload:X,onerror:e=>console.error(`Failed to load Cloudinary Upload Widget: ${e.message}`)}]}),(e,u)=>ee(e.$slots,"default",{cloudinary:s.value,widget:n.value,open:U,update:P,show:I,isShowing:b,isMinimized:F,isDestroyed:C,destroy:w,close:m,hide:S,minimize:E,results:i.value,error:a.value,isLoading:h.value})}});export{ie as _};
